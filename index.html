<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... existing head ... -->
    <style>
        /* ... existing styles ... */

        /* TICKTICK TASKS UPDATED */
        .task-item {
            display: flex; align-items: flex-start; /* Align top for multi-line */
            padding: 12px 0; border-bottom: 1px solid var(--border);
        }
        .task-item:last-child { border-bottom: none; }
        .task-icon { color: #6c757d; font-size: 1rem; margin-right: 12px; margin-top: 3px; }
        .task-content { flex-grow: 1; }
        .task-text { font-weight: 500; font-size: 0.95rem; line-height: 1.4; }
        .task-date { font-size: 0.75rem; font-weight: 600; margin-top: 2px; }
        
        /* Priority Colors */
        .prio-high { color: #dc3545; }   /* Red */
        .prio-med { color: #ffc107; }    /* Yellow */
        .prio-low { color: #0d6efd; }    /* Blue */
        .prio-none { color: #adb5bd; }   /* Grey */

        /* Date Colors */
        .date-overdue { color: #dc3545; }
        .date-today { color: #198754; }
        .date-future { color: #6c757d; }

        /* ... rest of styles ... */
    </style>
</head>
<body>
    <!-- ... existing body structure ... -->

    <script>
        // ... existing config ...

        // --- DASHBOARD (HQ) ---
        function loadDashboard() {
            fetch(`${API_URL}?action=getDashboard`)
            .then(res => res.json())
            .then(data => {
                // 1. TickTick Tasks
                const taskContainer = document.getElementById('task-list');
                if(!data.tasks || data.tasks.length === 0) {
                    taskContainer.innerHTML = '<div class="text-center text-muted small py-3">All caught up! No active tasks.</div>';
                } else {
                    taskContainer.innerHTML = data.tasks.map(t => {
                        // Format Date
                        let dateHtml = "";
                        if (t.dueDate) {
                            const dateObj = new Date(t.dueDate);
                            const now = new Date();
                            const isToday = dateObj.toDateString() === now.toDateString();
                            const isOverdue = dateObj < now && !isToday;
                            
                            // Formatting
                            const timeStr = t.isAllDay ? "" : dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            const dateStr = isToday ? "Today" : dateObj.toLocaleDateString([], {month: 'short', day: 'numeric'});
                            
                            const dateClass = isOverdue ? "date-overdue" : (isToday ? "date-today" : "date-future");
                            dateHtml = `<div class="task-date ${dateClass}">${dateStr} ${timeStr}</div>`;
                        }

                        // Priority Class (TickTick: 5=High, 3=Med, 1=Low, 0=None) - Mapping varies, usually High=High
                        // Simplified mapping based on TickTick standard
                        let prioClass = "prio-none";
                        if (t.priority === 5) prioClass = "prio-high";
                        else if (t.priority === 3) prioClass = "prio-med";
                        else if (t.priority === 1) prioClass = "prio-low";

                        return `
                        <div class="task-item">
                            <i class="fa-regular fa-circle task-icon ${prioClass}"></i>
                            <div class="task-content">
                                <div class="task-text">${t.title}</div>
                                ${dateHtml}
                            </div>
                        </div>
                    `}).join('');
                }

                // 2. Google Docs Journal
                const journalContainer = document.getElementById('journal-feed');
                if(data.journal && data.journal.length > 0) {
                    journalContainer.innerHTML = data.journal.map(j => `
                        <a href="${j.url}" target="_blank" class="journal-item">
                            <div class="journal-date">${j.date}</div>
                            <div class="journal-text">${j.title} <i class="fa-solid fa-arrow-up-right-from-square small ms-1" style="font-size:0.7em"></i></div>
                        </a>
                    `).join('');
                } else {
                    journalContainer.innerHTML = '<div class="text-center text-muted small py-2">No journals found.</div>';
                }
            });
        }

        // ... rest of script ...
    </script>
</body>
</html>
